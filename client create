<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Clients - ProGen AI</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f6f9; }
    #adminModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .modal-content { background: #fff; padding: 2.5rem; border-radius: 16px; width: 380px; box-shadow: 0 20px 40px rgba(0,0,0,.3); position: relative; }
    .modal-content::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); }
    .modal-content h3 { margin: 0 0 1.5rem; text-align: center; font-size: 1.8rem; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .input-group { margin-bottom: 1.5rem; }
    label { display: block; margin-bottom: .6rem; font-weight: 600; color: #555; }
    input { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; }
    input:focus { border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); outline: none; }
    .modal-actions { display: flex; gap: 1rem; margin-top: 2rem; }
    .modal-actions button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; flex: 1; }
    .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color:#fff; }
    .btn-secondary { background: #f8f9fa; color: #666; border: 2px solid #e1e5e9; }

    .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
    .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 2rem; color: white; display: flex; justify-content: space-between; align-items: center; }
    .navbar a { color: white; text-decoration: none; margin-left: 1.5rem; font-weight: 500; }

    .search-bar { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; margin-bottom: 1.5rem; }
    .search-bar:focus { border-color: #667eea; outline: none; }

    table { width: 100%; border-collapse: collapse; }
    th { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 1rem; text-align: left; }
    td { padding: 1rem; border-bottom: 1px solid #eee; vertical-align: middle; }
    tr:hover { background: #f8f9fa; }
    .btn-sm { padding: 6px 12px; margin: 0 4px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
    .btn-success { background: #28a745; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-danger { background: #dc3545; color: white; }
  </style>
</head>
<body>

  <div id="adminModal">
    <div class="modal-content">
      <h3>Admin Login</h3>
      <form id="adminLoginForm">
        <div class="input-group">
          <label>Admin Name</label>
          <input type="text" id="adminName" required />
        </div>
        <div class="input-group">
          <label>Password</label>
          <input type="password" id="adminPass" required />
        </div>
        <div class="modal-actions">
          <button type="button" id="cancelBtn" class="btn-secondary">Cancel</button>
          <button type="submit" class="btn-primary">Login</button>
        </div>
      </form>
    </div>
  </div>

  <div id="adminPanel" style="display:none;">
    <nav class="navbar">
      <div style="font-size: 1.6rem; font-weight: bold;">Client Management</div>
      <div>
        <a href="admin-create.html">Create Templates</a>
        <a href="admin-support.html">Support Center</a>
        <a href="index.html" id="logoutLink">Logout</a>
      </div>
    </nav>

    <div class="container">
      <div class="card">
        <h2>Manage Customers</h2>
        <input type="text" id="search" class="search-bar" placeholder="Search by company or email..." oninput="renderUsers()" />
        <table>
          <thead>
            <tr>
              <th>Company</th>
              <th>Email</th>
              <th>Industry</th>
              <th>Credits</th>
              <th>Last Login</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="userTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const ADMIN_NAME = 'admin';
    const ADMIN_PASS = 'admin001';
    const modal = document.getElementById('adminModal');
    const panel = document.getElementById('adminPanel');
    const form = document.getElementById('adminLoginForm');

    const setSession = () => sessionStorage.setItem('adminAuth', 'true');
    const clearSession = () => sessionStorage.removeItem('adminAuth');
    const isAuth = () => sessionStorage.getItem('adminAuth') === 'true';

    if (isAuth()) { modal.style.display = 'none'; panel.style.display = 'block'; renderUsers(); }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('adminName').value.trim();
      const pass = document.getElementById('adminPass').value;
      if (name === ADMIN_NAME && pass === ADMIN_PASS) {
        setSession();
        modal.style.display = 'none';
        panel.style.display = 'block';
        renderUsers();
      } else alert('Invalid credentials');
    });

    document.getElementById('cancelBtn').onclick = () => location.href = 'index.html';
    document.getElementById('logoutLink').onclick = e => { e.preventDefault(); clearSession(); location.href = 'index.html'; };

    function renderUsers() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const search = document.getElementById('search').value.toLowerCase();
      const tbody = document.getElementById('userTableBody');

      const filtered = users.filter(u => 
        (u.company || '').toLowerCase().includes(search) || 
        (u.email || '').toLowerCase().includes(search)
      );

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:3rem; color:#666;">No users found</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(user => `
        <tr>
          <td><strong>${user.company || 'N/A'}</strong></td>
          <td>${user.email}</td>
          <td>${user.industry || 'N/A'}</td>
          <td><input type="number" value="${user.credits || 0}" class="credit-input" data-id="${user.id}" style="width:70px;" min="0"></td>
          <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'}</td>
          <td>
            <button class="btn-sm btn-success" onclick="saveCredits(${user.id})">Save</button>
            <button class="btn-sm btn-secondary" onclick="editUser(${user.id})">Edit</button>
            <button class="btn-sm btn-danger" onclick="deleteUser(${user.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    window.saveCredits = function(id) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === id);
      const input = document.querySelector(`.credit-input[data-id="${id}"]`);
      const credits = parseInt(input.value) || 0;
      user.credits = credits;
      localStorage.setItem('users', JSON.stringify(users));
      alert(`Credits updated to ${credits}`);
    };

    window.editUser = function(id) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === id);
      const newName = prompt('New company name:', user.company);
      if (newName && newName.trim()) {
        user.company = newName.trim();
        localStorage.setItem('users', JSON.stringify(users));
        renderUsers();
      }
    };

    window.deleteUser = function(id) {
      if (confirm('Delete this user permanently?')) {
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        users = users.filter(u => u.id !== id);
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.removeItem(`questionnaireData_${id}`);
        renderUsers();
      }
    };
  </script>
</body>
</html>
